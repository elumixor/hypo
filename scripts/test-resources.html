<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resource Loading Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #1a1a1a;
            color: #fff;
        }
        .loading {
            color: #4ec9ff;
        }
        .success {
            color: #4caf50;
        }
        .error {
            color: #f44336;
        }
        .progress-bar {
            width: 100%;
            height: 20px;
            background: #333;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(45deg, #4ec9ff, #6cf);
            width: 0%;
            transition: width 0.3s ease;
        }
        pre {
            background: #2a2a2a;
            padding: 15px;
            border-radius: 8px;
            white-space: pre-wrap;
            font-size: 12px;
            line-height: 1.4;
        }
    </style>
</head>
<body>
    <h1>🎮 Resource Loading System Test</h1>
    <div id="status" class="loading">Initializing...</div>
    
    <div class="progress-bar">
        <div id="progressFill" class="progress-fill"></div>
    </div>
    <div id="progressText">0%</div>
    
    <h2>📋 Log</h2>
    <pre id="log"></pre>
    
    <script type="module">
        import { Resources } from '/src/resources/index.ts';
        
        const statusEl = document.getElementById('status');
        const progressFillEl = document.getElementById('progressFill');
        const progressTextEl = document.getElementById('progressText');
        const logEl = document.getElementById('log');
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logLine = `[${timestamp}] ${message}\n`;
            logEl.textContent += logLine;
            logEl.scrollTop = logEl.scrollHeight;
            
            if (type === 'error') {
                console.error(message);
            } else {
                console.log(message);
            }
        }
        
        async function testResources() {
            try {
                log('🎯 Creating resource manager...');
                
                const resources = new Resources('/hypo/assets')
                    .add('Drone.glb')
                    .add('kira.png');
                
                log(`📋 Resources configured: ${resources.names.join(', ')}`);
                
                statusEl.textContent = 'Loading resources...';
                statusEl.className = 'loading';
                
                log('📥 Starting resource loading...');
                
                await resources.loadAll((progress) => {
                    const percentage = Math.round(progress.percentage);
                    progressFillEl.style.width = percentage + '%';
                    progressTextEl.textContent = `${percentage}% (${progress.loaded}/${progress.total})`;
                    
                    if (progress.current) {
                        log(`⏳ Loading: ${progress.current}`);
                    }
                });
                
                log('✅ All resources loaded successfully!');
                
                // Test resource access
                const droneModel = resources.get('Drone');
                const kiraTexture = resources.get('kira');
                
                log(`🤖 Drone model loaded: ${droneModel.scene ? 'Has scene ✅' : 'No scene ❌'}`);
                log(`🖼️  Kira texture loaded: ${kiraTexture.width ? `${kiraTexture.width}x${kiraTexture.height}px ✅` : 'Invalid ❌'}`);
                
                statusEl.textContent = 'Resources loaded successfully!';
                statusEl.className = 'success';
                
                log('🎉 Test completed successfully!');
                
            } catch (error) {
                log(`❌ Error: ${error.message}`, 'error');
                statusEl.textContent = 'Failed to load resources';
                statusEl.className = 'error';
            }
        }
        
        log('🚀 Starting resource loading test...');
        testResources();
    </script>
</body>
</html>
